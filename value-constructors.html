<!DOCTYPE HTML>

<html lang="ru">
    <head>
        <meta charset="utf-8">
        <meta name="description" content="О Haskell по-человечески. Ваша первая книга о прекрасном и удивительном языке программирования.">
        <meta name="author" content="Денис Шевченко">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0">
        <title>
            О Haskell по-человечески
        </title>
        <link rel="icon" href="./static/images/favicon.ico">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js">
            
        </script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.5/css/materialize.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.5/js/materialize.min.js">
            
        </script>
        <link rel="stylesheet" href="./static/css/default.css">
        <script src="./static/js/default.js">
            
        </script>
    </head>
    <body>
        <div class="navbar-fixed">
            <nav>
                <div class="nav-wrapper">
                    <a class="brand-logo center sans" href="./">
                        #ohaskell
                    </a>
                    <a href="#" data-activates="mobile-demo" class="button-collapse show-on-large" style="padding-left: 15px;">
                        <span class="fa fa-list-ul" style="font-size: 26px;">
                            
                        </span>
                    </a>
                    <ul class="side-nav sans" id="mobile-demo">
                        <li>
                            <a href="./haskell-faq.html">
                                Первые вопросы
                            </a>
                        </li>
                        <li>
                            <a href="./this-book.html">
                                Об этой книге
                            </a>
                        </li>
                        <li>
                            <a href="./setup.html">
                                Приготовимся
                            </a>
                        </li>
                        <li>
                            <a href="./modules-minimum.html">
                                Модули: знакомство
                            </a>
                        </li>
                        <li>
                            <a href="./hackage.html">
                                Hackage
                            </a>
                        </li>
                        <li>
                            <a href="./expressions-n-functions.html">
                                Мир выражений и функций
                            </a>
                        </li>
                        <li>
                            <a href="./immutability-n-purity.html">
                                Неизменность и чистота
                            </a>
                        </li>
                    </ul>
                    <ul id="nav-mobile" class="right">
                        <li>
                            <a href="https://github.com/denisshevchenko/ohaskell.guide" target="_blank">
                                <span class="fa fa-github">
                                    
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="mailto:me@dshevchenko.biz?Subject=#ohaskell,%20О%20книге" title="Написать автору">
                                <span class="fa fa-envelope-o">
                                    
                                </span>
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>
        </div>
        <div class="container">
            <p>Конструктор значения (value constructor) - штука полезная. В этой главе поговорим о нём подробнее.</p>
<h2 id="иные-имена">Иные имена</h2>
<p>Конструктор значения может отличаться от имени самого типа. Взгляните:</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="kw">data</span> <span class="dt">IPAddress</span> <span class="fu">=</span> <span class="dt">IP</span> <span class="dt">String</span>  <span class="co">-- Имя типа осталось неизменным,</span>
                            <span class="co">-- но конструктор значения изменился.</span>

<span class="kw">instance</span> <span class="dt">Show</span> <span class="dt">IPAddress</span> <span class="kw">where</span>
              <span class="fu">|</span>
              тип

    show (<span class="dt">IP</span> address) <span class="fu">=</span> <span class="kw">if</span> address <span class="fu">==</span> <span class="st">&quot;127.0.0.1&quot;</span> <span class="kw">then</span> <span class="st">&quot;localhost&quot;</span> <span class="kw">else</span> address
          <span class="fu">|</span>
          конструктор
          значения</code></pre></div>
<p>Теперь мы будем создавать значения нашего типа так:</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell">main <span class="fu">=</span> putStrLn <span class="fu">.</span> show <span class="fu">$</span> <span class="dt">IP</span> <span class="st">&quot;127.0.0.1&quot;</span></code></pre></div>
<p>Такой подход позволяет писать более краткий, но при этом ничуть не менее понятный код.</p>
<h2 id="множество-конструкторов">Множество конструкторов</h2>
<p>Конструкторов значения может быть несколько, и эта возможность используется очень часто. Например:</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="kw">data</span> <span class="dt">IPAddress</span> <span class="fu">=</span> <span class="dt">IP</span> <span class="dt">String</span> <span class="fu">|</span> <span class="dt">Host</span> <span class="dt">String</span>
                 <span class="fu">|</span>           <span class="fu">|</span>
                 Первый      Второй
                 конструктор конструктор
                 значения    значения</code></pre></div>
<p>Мы ввели два конструктора, <code>IP</code> и <code>Host</code>. Здесь используется оператор <code>|</code>, знакомый программистам C как оператор бинарного “ИЛИ”. Выглядит довольно логично, и поэтому мы можем прочесть эту строку так:</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="kw">data</span> <span class="dt">IPAddress</span>  <span class="fu">=</span>    <span class="dt">IP</span> <span class="dt">String</span>  <span class="fu">|</span>    <span class="dt">Host</span> <span class="dt">String</span>
тип  <span class="dt">IPAddress</span>  это  <span class="dt">IP</span> <span class="dt">String</span>  или  <span class="dt">Host</span> <span class="dt">String</span></code></pre></div>
<p>Определим метод <code>show</code> для каждого из этих конструкторов:</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="kw">instance</span> <span class="dt">Show</span> <span class="dt">IPAddress</span> <span class="kw">where</span>
    show (<span class="dt">IP</span> address)   <span class="fu">=</span> address

    show (<span class="dt">Host</span> address) <span class="fu">=</span> <span class="kw">if</span> address <span class="fu">==</span> <span class="st">&quot;127.0.0.1&quot;</span> <span class="kw">then</span> <span class="st">&quot;localhost&quot;</span> <span class="kw">else</span> address</code></pre></div>
<p>Теперь, если мы напишем так:</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell">main <span class="fu">=</span> putStrLn <span class="fu">.</span> show <span class="fu">$</span> <span class="dt">IP</span> <span class="st">&quot;127.0.0.1&quot;</span></code></pre></div>
<p>вывод будет таким:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">127.0.0.1</span></code></pre></div>
<p>Если же мы используем второй конструктор:</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell">main <span class="fu">=</span> putStrLn <span class="fu">.</span> show <span class="fu">$</span> <span class="dt">Host</span> <span class="st">&quot;127.0.0.1&quot;</span></code></pre></div>
<p>вывод будет другим:</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell">localhost</code></pre></div>
<h2 id="множество-значений">Множество значений</h2>
<p>За конструктором значения может следовать как один тип, так и множество. Например, пусть наш <code>IPAddress</code> хранит не только адрес, но и порт:</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="kw">data</span> <span class="dt">IPAddress</span> <span class="fu">=</span> <span class="dt">Host</span> <span class="dt">String</span> <span class="dt">Int</span></code></pre></div>
<p>Как вы уже догадались, первое значение хранит адрес, второе - порт. Тогда создание значения типа <code>IPAddress</code> будет выглядеть так:</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell">main <span class="fu">=</span> putStrLn <span class="fu">.</span> show <span class="fu">$</span> <span class="dt">Host</span> <span class="st">&quot;127.0.0.1&quot;</span> <span class="dv">3010</span></code></pre></div>
<p>Взяли строку, взяли целое число, затем “применили” к ним конструктор <code>Host</code> - и в результате получилось значение типа <code>IPAddress</code>.</p>
<h2 id="о-нульарных-конструкторах">О нульарных конструкторах</h2>
<p>Нульарный конструктор (nullary constructor) используется в Haskell довольно часто. Суть его предельно проста. Вспомним наш демонстрационный тип:</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="kw">data</span> <span class="dt">IPAddress</span> <span class="fu">=</span> <span class="dt">IP</span> <span class="dt">String</span></code></pre></div>
<p>За конструктором <code>IP</code> следует одно значение, поэтому такой конструктор называют одинарным. А нульарным называют такой конструктор, за которым никакого значения нет. Вы спросите, зачем это нужно? Вот пример.</p>
<p>Допустим, нам нужен тип, ассоциированный с протоколами транспортного слоя (Transport layer) модели OSI. Вот как это будет выглядеть:</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="kw">data</span> <span class="dt">TransportLayer</span> <span class="fu">=</span> <span class="dt">TCP</span> <span class="fu">|</span> <span class="dt">UDP</span> <span class="fu">|</span> <span class="dt">SCTP</span> <span class="fu">|</span> <span class="dt">DCCP</span> <span class="fu">|</span> <span class="dt">SPX</span></code></pre></div>
<p>Символ <code>|</code> вы уже знаете, но значений, как видите, здесь нет. Тип <code>TransportLayer</code> имеет пять нульарных конструкторов. И чтобы продемонстрировать практическую пользу такого типа, определим функцию, описывающую конкретный протокол:</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="ot">descriptionOf ::</span> <span class="dt">TransportLayer</span> <span class="ot">-&gt;</span> <span class="dt">String</span>
descriptionOf protocol <span class="fu">=</span>
    <span class="kw">case</span> protocol <span class="kw">of</span>
        <span class="dt">TCP</span>  <span class="ot">-&gt;</span> <span class="st">&quot;Transmission Control Protocol&quot;</span>
        <span class="dt">UDP</span>  <span class="ot">-&gt;</span> <span class="st">&quot;User Datagram Protocol&quot;</span>
        <span class="dt">SCTP</span> <span class="ot">-&gt;</span> <span class="st">&quot;Stream Control Transmission Protocol&quot;</span>
        <span class="dt">DCCP</span> <span class="ot">-&gt;</span> <span class="st">&quot;Datagram Congestion Control Protocol&quot;</span>
        <span class="dt">SPX</span>  <span class="ot">-&gt;</span> <span class="st">&quot;Sequenced Packet Exchange&quot;</span></code></pre></div>
<p>Мы принимаем значение типа <code>TransportLayer</code> и возвращаем соответствующее ему строковое описание. Обратите внимание на конструкцию с ключевым словом <code>case</code>. Это - родственница конструкции <code>switch-case</code> из языка C, реализующая выбор из множества вариантов.</p>
<p>Теперь проверяем:</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell">main <span class="fu">=</span> print <span class="fu">$</span> descriptionOf <span class="dt">TCP</span></code></pre></div>
<p>Для создания значения типа <code>TransportLayer</code>, к которому будет применена функция <code>descriptionOf</code>, мы использовали один из нульарных конструкторов. Никакого дополнительного значения здесь нет, потому что с концептуальной точки зрения сам нульарный конструктор и представляет собой значение. Результат будет такой:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="st">&quot;Transmission Control Protocol&quot;</span></code></pre></div>
<p>Если вам нужен тип, подразумевающий фиксированное множество именованных значений - нульарные конструкторы вам помогут.</p>
<h2 id="в-сухом-остатке">В сухом остатке</h2>
<ol style="list-style-type: decimal">
<li>Конструктор значения (далее КЗ) используется при конструировании значении.</li>
<li>Имя КЗ может отличаться от имени самого типа.</li>
<li>КЗ может быть сколько угодно, от нуля и больше.</li>
<li>КЗ может работать как без конкретных значений (и тогда его называют нульарным), так и с любым числом значений.</li>
</ol>
<div style="padding-top: 45px;">
    
</div>
<div class="row">
    <div class="col s3">
        <div class="left">
            <a href="PREV_CHAPTER_URL" class="btn waves-effect waves-light chapter-arrow">
                <span class="fa fa-angle-double-left">
                    
                </span>
            </a>
        </div>
    </div>
    <div class="col s6">
        <div class="center-align">
            <button class="waves-effect waves-light btn blue lighten-2 show-comments sans">
                Обсудим?
            </button>
        </div>
    </div>
    <div class="col s3">
        <div class="right">
            <a href="NEXT_CHAPTER_URL" class="btn waves-effect waves-light chapter-arrow">
                <span class="fa fa-angle-double-right">
                    
                </span>
            </a>
        </div>
    </div>
</div>
<div style="padding-top: 20px;">
    
</div>
<div id="disqus_thread" style="padding-top: 30px;">
    
</div>

        </div>
    </body>
</html>
